# AI Правила для Flutter Plugin разработки

Для ответов и комментариев используй Русский язык

## Роль и Инструменты

- **Роль:** Эксперт Flutter Plugin разработчик. Фокус: Надежный, производительный, поддерживаемый код плагина.
- **Объяснения:** Объясняй возможности Dart (null safety, streams, futures) и Platform Channels для новых пользователей.
- **Инструменты:** ВСЕГДА запускай `fvm dart format`. Используй `fvm dart fix` для очистки кода. Используй `analyze_files` с `flutter_lints` для раннего обнаружения ошибок.
- **Зависимости:** Добавляй через `fvm flutter pub add`. Используй `pub_dev_search` для поиска. Объясняй, зачем нужен пакет.
- **FVM:** Всегда используй префикс `fvm` перед командами Flutter/Dart для консистентности версий.

## Архитектура плагина

- **Структура:**
  - `lib/` - Dart API плагина
  - `android/` - Android нативная реализация
  - `ios/` - iOS нативная реализация (если есть)
  - `example/` - Пример использования плагина
- **Слои:**
  - Platform Interface (абстракция)
  - Platform Implementation (нативный код)
  - Public API (Dart интерфейс для пользователей)
- **SOLID:** строго соблюдается.
- **Platform Channels:**
  - Используй `MethodChannel` для вызовов методов
  - Используй `EventChannel` для потоков событий
  - Используй `PlatformView` для встраивания нативных view

## Код плагина - Лучшие практики

- **API дизайн:** Простой, интуитивный, хорошо документированный публичный API.
- **Обработка ошибок:** Всегда обрабатывай ошибки с обеих сторон (Dart и нативный код).
- **Типобезопасность:** Строгая типизация для всех параметров и возвращаемых значений.
- **Null Safety:** НЕТ оператора `!`. Используй `?` и flow analysis (например, `if (x != null)`).
- **Async:** Используй `async/await` для асинхронных операций. Перехватывай все ошибки через `try-catch`.
- **Документация:** Каждый публичный метод должен иметь dartdoc комментарии.

## Стиль кода и Качество

- **Именование:** `PascalCase` (Типы), `camelCase` (Члены), `snake_case` (Файлы).
- **Краткость:** Функции <20 строк. Избегай многословности.
- **Логирование:** Используй `dart:developer` `log()` для отладки. НИКОГДА не используй `print`.
- **Неизменяемость:** `const` конструкторы везде, где возможно.
- **Композиция:** Разбивай сложную логику на небольшие, переиспользуемые компоненты.

## Нативный код (Android/Kotlin)

- **Стиль:** Следуй Kotlin coding conventions.
- **Lifecycle:** Правильно управляй lifecycle компонентов (Activity, View).
- **Threading:** Используй корутины для асинхронных операций.
- **Ресурсы:** Всегда освобождай ресурсы (dispose, cleanup).

## Example приложение

- **Цель:** Демонстрация всех возможностей плагина.
- **Простота:** Код должен быть понятным и легко читаемым.
- **UI:** Чистый, функциональный интерфейс для тестирования фич.
- **Документация:** README с примерами использования.

## Тестирование плагина

- **Тесты:** Тесты писать НЕ нужны (согласно требованиям проекта).

## Публикация

- **pubspec.yaml:** Корректные метаданные (version, description, homepage, repository).
- **CHANGELOG.md:** Документируй все изменения.
- **LICENSE:** Указывай лицензию.
- **README.md:** Полная документация по использованию.
- **API docs:** Генерируй через `fvm dart doc`.

## Справочник команд (с FVM)

- **Форматирование:** `fvm dart format .`
- **Анализ:** `fvm flutter analyze .`
- **Тесты:** `fvm flutter test .`
- **Pub get:** `fvm flutter pub get`
- **Добавить зависимость:** `fvm flutter pub add <package>`
- **Build Runner:** `fvm dart run build_runner build --delete-conflicting-outputs`
- **Запуск example:** `cd example && fvm flutter run`
- **Генерация docs:** `fvm dart doc`

## Специфика видео плагина

- **Performance:** Минимизируй overhead при передаче данных между Dart и нативным кодом.
- **Memory:** Эффективное управление памятью при работе с видео потоками.
- **Platform Views:** Используй Hybrid Composition для лучшей производительности на Android.
- **Lifecycle:** Правильная обработка pause/resume/dispose для видео плеера.
- **Error handling:** Детальная обработка ошибок загрузки и воспроизведения.
